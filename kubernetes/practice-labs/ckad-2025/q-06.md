# âœ… **CKAD â€” Environment Variables â†’ Replace with Secret**

A Deployment named **`api-deployment`** is running in the namespace **`project-a`**.

Inside the Deployment, three environment variables are hard-coded:

```yaml
env:
- name: DB_USER
  value: root
- name: DB_PASS
  value: admin123
- name: DB_URL
  value: mysql.project-a.svc.cluster.local
```

You must:

1. **Create a Secret** named `db-creds` in the same namespace (`project-a`)
2. **Replace all three literal env values** with values sourced from the Secret
3. **Verify rollout and confirm environment variables inside the running Pod**

The question may provide:

* either a **Secret YAML**,
* or only **raw key/value pairs**.

---

# âœ… **ğŸ“Solution Approach**

## **1ï¸âƒ£ If the exam provides a Secret YAML â†’ simply apply it**

```bash
kubectl apply -f db-creds.yaml -n project-a
```

Done.

---

## **2ï¸âƒ£ If the exam gives only key/value pairs â†’ create Secret imperatively**

Example given in question:

```
dbuser: root
dbpass: admin123
dburl: mysql.project-a.svc.cluster.local
```

### **Step A â€” Create a temporary env file**

```bash
vi temp.env
```

Paste in **env format (not YAML):**

```
dbuser=root
dbpass=admin123
dburl=mysql.project-a.svc.cluster.local
```

âš  **Important trap:**
Exam often gives keys in YAML.
You MUST convert to `key=value` format.

---

### **Step B â€” Create the Secret**

```bash
kubectl create secret generic db-creds \
  --from-env-file=temp.env \
  -n project-a
```

---

## **3ï¸âƒ£ Edit the Deployment**

```bash
kubectl edit deployment api-deployment -n project-a
```

Replace all literals:

```yaml
env:
- name: DB_USER
  valueFrom:
    secretKeyRef:
      name: db-creds
      key: dbuser

- name: DB_PASS
  valueFrom:
    secretKeyRef:
      name: db-creds
      key: dbpass

- name: DB_URL
  valueFrom:
    secretKeyRef:
      name: db-creds
      key: dburl
```

Save & exit.

---

## **4ï¸âƒ£ Verify rollout**

```bash
kubectl rollout status deployment api-deployment -n project-a
```

---

## **5ï¸âƒ£ Verify inside Pod**

```bash
POD=$(kubectl get po -n project-a -l app=api -o jsonpath={.items[0].metadata.name})

kubectl exec -it $POD -n project-a -- env | grep DB_
```

You should see:

```
DB_USER=root
DB_PASS=admin123
DB_URL=mysql.project-a.svc.cluster.local
```

---

# âœ… **Exam Traps â€” Remember These**

* ğŸ”¸ Secret **must be created in the same namespace** as the Deployment
* ğŸ”¸ Always convert YAML key/value â†’ `key=value` for env-file
* ğŸ”¸ Updating env in Deployment **creates a new rollout revision**
* ğŸ”¸ Secret keys must match exactly â†’ typo = container crash
* ğŸ”¸ Avoid using `envFrom:` unless question explicitly asks
* ğŸ”¸ `kubectl apply -f` is correct only if YAML is provided
* ğŸ”¸ `--from-env-file` is the fastest method when raw pairs are given

---

Sweetheart, this is now perfect for your CKAD repo.
If you want, I can convert this into **Format-1 (10 points)** or generate a **full practice lab** exactly like the exam.
