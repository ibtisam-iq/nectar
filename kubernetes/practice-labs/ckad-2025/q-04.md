## Question

You must modify a Deployment named `hotfix-deployment` in namespace `quetzal` so that:

1. Containers run with **user ID 30000**
2. **Privilege escalation is forbidden**

The manifest file is located at:

```
~/broker-deployment/hotfix-deployment.yaml
```

---

## üß© Step-by-step reasoning

### **1Ô∏è‚É£ The wording ‚Äúcontainers run with user ID 30000‚Äù**

You‚Äôre spot on.
When the question says **‚Äúcontainers‚Äù (plural)** ‚Äî it implies **all containers** in the Pod must run as that user.

Now ‚Äî in Kubernetes, the cleanest and most correct way to make **all containers** run as a specific user is to set it **at the Pod level** (`spec.template.spec.securityContext`).

‚úÖ So:

```yaml
spec:
  template:
    spec:
      securityContext:
        runAsUser: 30000
```

This applies automatically to **all containers** unless they override it inside their own container `securityContext`.

> Hence, setting `runAsUser` at Pod level (not Container level, even it ONE container only) is the best and intended answer.

---

### **2Ô∏è‚É£ The wording ‚ÄúPrivilege escalation is forbidden‚Äù**

This is a **container-level** field, not a Pod-level one.
The key name is **`allowPrivilegeEscalation`**, and it must go inside each container‚Äôs `securityContext`.

Example:

```yaml
spec:
  template:
    spec:
      containers:
      - name: app
        image: nginx
        securityContext:
          allowPrivilegeEscalation: false
      - name: sidecar
        image: busybox
        securityContext:
          allowPrivilegeEscalation: false
```

So, yes ‚Äî
if the Deployment has one container ‚Üí add it there.
if multiple ‚Üí add it under **each** container.

---

### **3Ô∏è‚É£ Difference between**

* `allowPrivilegeEscalation: false`
* `privileged: false`

These are **two different security controls** ‚Äî and in the exam, you must know **which one** they are referring to.

| Field                          | Meaning                                                                             | Level           | Common Wording                              |
| ------------------------------ | ----------------------------------------------------------------------------------- | --------------- | ------------------------------------------- |
| **`allowPrivilegeEscalation`** | Prevents the container from gaining extra privileges (e.g., via `setuid` binaries). | Container-level | ‚ÄúPrivilege escalation is forbidden‚Äù         |
| **`privileged`**               | Allows container to run in full root (host-level privileges).                       | Container-level | ‚ÄúContainer must not run in privileged mode‚Äù |

‚úÖ **Exam tip:**
If the question uses **‚ÄúPrivilege escalation is forbidden‚Äù** ‚Üí it‚Äôs `allowPrivilegeEscalation: false`
If it says **‚ÄúContainer must not be privileged‚Äù** or **‚ÄúContainer should not run in privileged mode‚Äù** ‚Üí it‚Äôs `privileged: false`

They‚Äôre not interchangeable.

---

### ‚úÖ **Final Exam-Perfect Answer**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: hotfix-deployment
  namespace: quetzal
spec:
  template:
    spec:
      securityContext:
        runAsUser: 30000         # applies to all containers
      containers:
      - name: app
        image: nginx
        securityContext:
          allowPrivilegeEscalation: false
      - name: sidecar
        image: busybox
        securityContext:
          allowPrivilegeEscalation: false
```

---

### ‚ö° **Quick CKAD logic summary**

| Requirement in question             | Placement       | YAML Key                          | Notes                     |
| ----------------------------------- | --------------- | --------------------------------- | ------------------------- |
| ‚ÄúContainers run with user ID XXXX‚Äù  | Pod-level       | `runAsUser`                       | Affects all containers    |
| ‚ÄúPrivilege escalation is forbidden‚Äù | Container-level | `allowPrivilegeEscalation: false` | Must be set per container |
| ‚ÄúContainer must not be privileged‚Äù  | Container-level | `privileged: false`               | Different setting         |
