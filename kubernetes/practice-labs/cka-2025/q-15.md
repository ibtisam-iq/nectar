# âœ… **CKA-2025 â€” Q-15 (NetworkPolicy Communication) â€” Full Professional Rewrite**

## ğŸ”¶ **Question (rewritten professionally)**

You are given two Deployments running in **separate namespaces**:

* Namespace **frontend**

  * Deployment: `mysql-checker`

* Namespace **backend**

  * Deployment: `mysql`
  * Service: `mysql-service` (port 3306)

Both namespaces currently enforce a **deny-all security posture**:

* `deny-all-ingress`
* `deny-all-egress`

Your job:

1. Inspect the deployments to understand how they must communicate.
2. From the folder `~/netpol/`, choose **one** NetworkPolicy to allow the required communication.
3. Your chosen policy must:

   * Allow **ONLY** necessary communication
   * Be **as restrictive as possible**
4. You MUST NOT delete or modify any existing deny-all policies.
5. If the deny-all policies block communication in the other namespace, create additional NetworkPolicy **only where needed**.

Goal:

âœ”ï¸ Allow **frontend â†’ backend (MySQL)** communication
âœ”ï¸ Everything else must stay blocked
âœ”ï¸ Least privilege security
âœ”ï¸ All Pods must become functional

---

# âœ… **Step-1 â€” Understand Required Communication**

From your Deployment:

```
env:
  MYSQL_HOST: mysql-service.backend.svc.cluster.local
  MYSQL_PORT: "3306"
```

Communication required:

ğŸ‘‰ **frontend pod must connect OUT (egress)**
ğŸ‘‰ **backend pod must accept INGRESS on port 3306**

So required policy:

* Backend needs **Ingress allow**
* Frontend needs **Egress allow**

---

# âœ… **Step-2 â€” Check What Is Already Blocked**

You already applied these:

### **In frontend namespace:**

* deny-all-egress âŒ
* deny-all-ingress âŒ

### **In backend namespace:**

* deny-all-egress âŒ
* deny-all-ingress âŒ

Meaning:

* Frontend cannot send requests (egress = blocked)
* Backend cannot receive requests (ingress = blocked)

---

# âœ… **Step-3 â€” Inspect Provided Netpol Files in `~/netpol/`**

You have:

### **netpol-1.yaml**

Allows all frontend â†’ backend (Ingress only)

### **netpol-2.yaml** âœ”ï¸ (least privilege)

Allows only:

* namespace = frontend
* podLabel = app=frontend
* port 3306
  (also Ingress only)

### **netpol-3.yaml**

Deny everything (useless)

### âš ï¸ IMPORTANT

ğŸ’¡ **ALL THREE policies fix only backend Ingress**
They do NOT fix frontend Egress.

So selecting netpol-2.yaml solves only half of the problem.

That is the hidden exam trap.

---

# âœ… Step-4 â€” Apply the correct pre-provided Netpol

Apply netpol-2.yaml to backend:

```
kubectl apply -f ~/netpol/netpol-2.yaml
```

This fixes:

âœ”ï¸ backend ingress â†’ allowed
âŒ frontend egress â†’ still blocked

---

# âœ… Step-5 â€” Create NEW NetworkPolicy to allow frontend Egress

Because frontend namespace has:

```
deny-all-egress
```

You must create a new custom policy:

## **frontend-allow-egress.yaml**

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-egress-to-backend
  namespace: frontend
spec:
  podSelector:
    matchLabels:
      app: frontend
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: backend
          podSelector:
            matchLabels:
              app: backend
      ports:
        - protocol: TCP
          port: 3306
```

This allows:

âœ”ï¸ frontend â†’ backend â†’ 3306
âœ”ï¸ everything else still BLOCKED
âœ”ï¸ Least privilege
âœ”ï¸ Deny-All policies remain untouched
âœ”ï¸ Exam requirement satisfied

---

# âœ… **Final Working Set of Policies**

### 1ï¸âƒ£ deny-all (already applied)

### 2ï¸âƒ£ backend ingress allow (from netpol-2.yaml)

### 3ï¸âƒ£ frontend egress allow (custom YAML above)

This is EXACT behavior expected by exam designers.

---
