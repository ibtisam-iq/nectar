# Kubernetes CNI Installation & Troubleshooting Guide (CKA-Style)

This guide covers **all possible ways** the CNI question can appear in the CKA exam and provides a **step‚Äëby‚Äëstep formula** to solve it reliably.

---

## Question: Install a CNI (Flannel or Calico)

You may be asked to install:

* **Flannel v0.26.1** (kube-flannel.yml)
* **Calico v3.28.2** (tigera-operator.yaml)

But the cluster may have a **different PodCIDR** than what the manifests assume.
This causes nodes NOT to get subnets ‚Üí CNI fails.

This guide solves that.

---

## ‚úÖ Possible Exam Scenarios (Only 3)

These are the *only* situations the CNI question can appear in the CKA exam:

### **Scenario 1 ‚Äî Normal CNI install (Pod‚Äëto‚ÄëPod communication must work)**

* Both manifests (Flannel + Calico) are provided.
* No extra requirement.
* You can use **either one**.

### **Scenario 2 ‚Äî NetworkPolicies must work**

* Both manifests (Flannel + Calico) are provided.
* Question says: *‚ÄúNetworkPolicy must be enforced.‚Äù*
* You **must choose Calico** (Flannel does NOT support NetworkPolicy).

### **Scenario 3 ‚Äî Use the provided Pod CIDR**

* They give a specific CIDR.
* Must deploy a CNI using **that exact CIDR**.
* You must edit the manifest (Flannel or Calico) before applying.

---

## ‚úÖ Find the REAL PodCIDR

Always run this first:

```bash
kubectl get cm -n kube-system -o yaml | grep -i cidr
```

This gives you something like:

```
clusterCIDR: 172.17.0.0/16
```

Use THIS CIDR in the CNI config.

---

## ‚úÖ How to Deploy **Flannel** (Step-by-Step)

Flannel default PodCIDR = **10.244.0.0/16**

### **Step 1 ‚Äî Download Flannel manifest**

```bash
wget -O kube-flannel.yml \
https://github.com/flannel-io/flannel/releases/download/v0.26.1/kube-flannel.yml
```

### **Step 2 ‚Äî Edit Flannel CIDR**

Inside the file, find:

```yaml
net-conf.json: |
  {
    "Network": "10.244.0.0/16",
```

Replace with:

```yaml
"Network": "<CLUSTER-CIDR>",
```

(Replace from the CIDR command above.)

### **Step 3 ‚Äî Apply Flannel**

```bash
kubectl apply -f kube-flannel.yml
```

### **Step 4 ‚Äî Restart Flannel (Optional)**

```bash
kubectl delete pod -n kube-system -l app=flannel
```

Done. Flannel installed.

---

## ‚úÖ How to Deploy **Calico** (Step-by-Step)

Very IMPORTANT differences:

* The **operator** must be installed using `kubectl create -f`
* The **custom-resources** file should be downloaded using `wget -O` and edited
* THEN applied

### **Step 1 ‚Äî Install Calico Operator (DO NOT USE apply)**

```bash
kubectl create -f \
https://raw.githubusercontent.com/projectcalico/calico/v3.28.2/manifests/tigera-operator.yaml
```

### **Step 2 ‚Äî Download custom-resources.yaml**

```bash
wget -O custom-resources.yaml \
https://raw.githubusercontent.com/projectcalico/calico/v3.28.2/manifests/custom-resources.yaml
```

### **Step 3 ‚Äî Edit Calico Pod CIDR**

Find:

```yaml
cidr: 192.168.0.0/16
```

Replace with:

```yaml
cidr: <CLUSTER-CIDR>
```

### **Step 4 ‚Äî Apply custom resources**

```bash
kubectl apply -f custom-resources.yaml
```

### **Step 5 ‚Äî Restart Calico (if needed)**

```bash
kubectl delete pod -n calico-system -l k8s-app=calico-node
```

Done. Calico installed.

---

# üéØ Final CKA Formula (Very Short)

1. Find cluster CIDR ‚Üí `grep -i cidr` command
2. Edit the CNI manifest (Flannel ‚Üí net-conf.json, Calico ‚Üí IPPool)
3. Install the correct CNI:

   * Flannel ‚Üí `kubectl apply -f kube-flannel.yml`
   * Calico ‚Üí `kubectl create -f tigera-operator.yaml`; `kubectl apply -f custom-resources.yaml`
4. Restart CNI pods if needed.
5. Check node readiness ‚Üí `kubectl get nodes`

This is all you need.

